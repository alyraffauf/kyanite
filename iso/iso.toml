# Anaconda ISO Installer Configuration
# This configuration creates a bootable ISO image for installing your custom bootc image.
#
# The installer will guide users through disk partitioning and basic system setup,
# then automatically switch to your custom image on first boot.

[customizations.installer.kickstart]
contents = """
%post
# After installation, switch to the custom image from this repository
# IMPORTANT: Update this URL to match your repository (ghcr.io/alyraffauf/kyanite:stable)
bootc switch --mutate-in-place --transport registry ghcr.io/alyraffauf/kyanite:stable

# Pre-install essential Flatpaks after bootc switch
# This ensures Firefox and Bazaar are available immediately on first boot,
# even without an internet connection.
echo "Installing essential Flatpaks..."

# Add flathub remote if not already present
flatpak remote-add --if-not-exists --system flathub https://flathub.org/repo/flathub.flatpakrepo || true

# Install Firefox (web browser - essential for users without internet)
flatpak install --system --noninteractive -y flathub org.mozilla.firefox || echo "Firefox install failed, will retry on first boot"

# Install Bazaar (Flatpak store - essential for managing apps without internet)
flatpak install --system --noninteractive -y flathub io.github.kolunmi.Bazaar || echo "Bazaar install failed, will retry on first boot"

echo "Essential Flatpaks installation complete"
%end
"""

[customizations.installer.modules]
# Enable standard Anaconda installer modules for a guided installation experience
enable = [
  "org.fedoraproject.Anaconda.Modules.Storage",    # Disk partitioning and formatting
  "org.fedoraproject.Anaconda.Modules.Runtime",    # Basic runtime configuration
  "org.fedoraproject.Anaconda.Modules.Network",    # Network configuration
  "org.fedoraproject.Anaconda.Modules.Security",   # Security settings
  "org.fedoraproject.Anaconda.Modules.Services",   # System services
  "org.fedoraproject.Anaconda.Modules.Users",      # User account creation
  "org.fedoraproject.Anaconda.Modules.Timezone"    # Timezone selection
]

# Disable subscription management (not needed for community images)
disable = [
  "org.fedoraproject.Anaconda.Modules.Subscription",
]
