---
name: Validate Justfiles
permissions:
    contents: read

on:
    pull_request:
        paths:
            - "ujust/**"
            - "Justfile"

jobs:
    validate:
        name: Validate Justfiles
        runs-on: ubuntu-latest
        steps:
            - name: Checkout Repository
              uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6

            - name: Install Just
              uses: extractions/setup-just@f8a3cce218d9f83db3a2ecd90e41ac3de6cdfd9b # v3

            - name: Validate Justfiles
              run: |
                  echo "Validating Justfiles..."
                  echo ""

                  set -euo pipefail

                  # Validate root Justfile
                  echo "::group::Validating Justfile"
                  set -x
                  just --unstable --fmt --check -f Justfile
                  set +x
                  echo "✓ Justfile passed validation"
                  echo "::endgroup::"

                  # Validate ujust files
                  find "ujust" -iname '*.just' -print0 | \
                    while IFS= read -r -d '' justfile; do
                      echo "::group::Validating $(basename "${justfile}")"
                      set -x
                      just --unstable --fmt --check -f "${justfile}"
                      set +x
                      echo "✓ $(basename "${justfile}") passed validation"
                      echo "::endgroup::"
                    done

                  echo ""
                  echo "All Justfiles validated successfully"
