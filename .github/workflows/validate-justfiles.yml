---
name: Validate Justfiles
permissions:
    contents: read

on:
    pull_request:
        paths:
            - "custom/ujust/**"
            - "Justfile"

jobs:
    validate:
        name: Validate Justfiles
        runs-on: ubuntu-latest
        steps:
            - name: Checkout Repository
              uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6

            - name: Install Just
              uses: extractions/setup-just@e33e0265a09d6d736e2ee1e0eb685ef1de4669ff # v3

            - name: Validate Justfiles
              run: |
                  echo "Validating Justfiles..."
                  echo ""

                  set -euo pipefail

                  # Validate root Justfile
                  echo "::group::Validating Justfile"
                  set -x
                  just --unstable --fmt --check -f Justfile
                  set +x
                  echo "✓ Justfile passed validation"
                  echo "::endgroup::"

                  # Validate custom ujust files
                  find "custom/ujust" -iname '*.just' -print0 | \
                    while IFS= read -r -d '' justfile; do
                      echo "::group::Validating $(basename "${justfile}")"
                      set -x
                      just --unstable --fmt --check -f "${justfile}"
                      set +x
                      echo "✓ $(basename "${justfile}") passed validation"
                      echo "::endgroup::"
                    done

                  echo ""
                  echo "All Justfiles validated successfully"
